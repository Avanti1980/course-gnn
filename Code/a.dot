digraph DeployRule {
    fontname="方正苏新诗柳楷简体-yolan";
    colorscheme="svg";
    edge [comment="全局默认设定", 
          fontname="方正苏新诗柳楷简体-yolan", 
          fontsize=10, 
          colorscheme="blues3", 
          color=2, 
          fontcolor=3];
    node [fontname="方正苏新诗柳楷简体-yolan", 
          fontsize=13, 
          fillcolor="1", 
          colorscheme="blues4", 
          color="2", 
          fontcolor="4", 
          style="filled"];
    "工单系统" [comment="以工单为新项目部署的流程入口", 
                    URL="https://www.tapd.cn", 
                    shape="hexagon", 
                    target="_blank", 
                    color="blue", 
                    label="工单系统"];
    "操作人员" [label="操作人员"];
    subgraph "cluster0" {
        label="发布系统v1.0";
        "Ansible" [shape="circle",style="diagonals",label="Ansible"];
        "Gitlab代码库" [shape="circle",style="diagonals",label="Gitlab代码库"];
        "Ftp文件共享" [shape="circle",style="diagonals",label="Ftp文件共享"];
        subgraph "cluster01" {
            label="测试环境";
            "功能测试环境" [shape="box3d",label="功能测试环境"];
            "集成测试环境" [shape="box3d",label="集成测试环境"];
            "OpsMng-测试环境" [label="OpsMng-测试环境"];
            "Jenkins-测试环境" [label="Jenkins-测试环境"];
            "OpsMng-测试环境" -> "Jenkins-测试环境"  [style="dotted",label="构建任务"];
        }

        subgraph "cluster02" {
            center="true";
            label="生产环境";
            "预发布环境" [shape="box3d",label="预发布环境"];
            "线上生产环境" [shape="box3d",label="线上生成环境"];
            "Jenkins-生产环境" [label="Jenkins-生产环境"];
            "OpsMng-生产环境" [label="OpsMng-生产环境"];
            "OpsMng-生产环境" -> "Jenkins-生产环境"  [style="dotted",label="构建任务"];
        }

        "Gitlab代码库" -> "Ansible"  [style="dashed",label="拉取"];
        "Gitlab代码库" -> "Jenkins-测试环境"  [style="dashed",label="拉取"];
        "Gitlab代码库" -> "Jenkins-生产环境"  [style="dashed",label="拉取"];
        "Ftp文件共享" -> "Ansible"  [style="dashed",label="拉取"];
        "OpsMng-测试环境" -> "Ansible"  [color="blue",style="bold",label="发布"];
        "OpsMng-生产环境" -> "Ansible"  [color="blue",style="bold",label="发布"];
        "Jenkins-测试环境" -> "Ftp文件共享"  [style="dotted",label="推送"];
        "Jenkins-生产环境" -> "Ftp文件共享"  [style="dotted",label="推送"];
        "Ansible" -> "功能测试环境"  [color="blue",label="部署"];
        "Ansible" -> "线上生产环境"  [color="blue",label="部署"];
        "Ansible" -> "集成测试环境"  [color="blue",label="部署"];
        "Ansible" -> "预发布环境"  [color="blue",label="部署"];
        {
            rank=same;
            "预发布环境";
            "线上生产环境";
            "功能测试环境";
            "集成测试环境";
        }

        {
            rank=same;
            "Gitlab代码库";
            "Ftp文件共享";
        }

    }

    subgraph "cluster1" {center="true";label="发布系统v2.0";}

    "工单系统" -> "操作人员"  [label="审批"];
    "操作人员" -> "OpsMng-测试环境"  [color="blue",style="bold",label="管理发布"];
    "操作人员" -> "OpsMng-生产环境"  [color="blue",style="bold",label="管理发布"];
}